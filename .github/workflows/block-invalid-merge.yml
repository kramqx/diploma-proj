name: Block forbidden merges

on:
  pull_request:

jobs:
  forbid-merge:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR source and target branches
        run: |
          SRC="${{ github.head_ref }}"
          TARGET="${{ github.base_ref }}"

          echo "Source branch: $SRC"
          echo "Target branch: $TARGET"

          if [[ "$SRC" == "main" && "$TARGET" != "main" ]]; then
            echo "Merging from main to any branch other than main is forbidden!"
            exit 1
          fi

          echo "Merge allowed"
